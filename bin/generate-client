#!/usr/bin/env node

const fs = require("fs");
const ejs = require("ejs");
const path = require("path");
const prettier = require("prettier");
const pluralize = require("pluralize");
const { promisify } = require("util");

const writeFile = promisify(fs.writeFile);

const withDefaults = items =>
  items.map(item => ({
    plural: pluralize(item.name),
    type: item.name,
    ...item
  }));

const template = path.join(__dirname, "../gen/template.ejs");
const data = { objects: withDefaults(require("../gen/input.json")) };

ejs
  .renderFile(template, data)
  .then(code => prettier.format(code, { parser: "typescript" }))
  .then(code => writeFile("src/Kubernetes.ts", code))
  .catch(err => console.error(err));
